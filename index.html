<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF ⟷ PNG Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .title {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .converter-tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .tab-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .converter-section {
            display: none;
        }

        .converter-section.active {
            display: block;
        }

        .drop-zone {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafbfc;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .drop-zone:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .drop-zone.dragover {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            transform: scale(1.02);
        }

        .drop-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .drop-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }

        .drop-subtext {
            color: #999;
            font-size: 0.9em;
        }

        .file-input {
            display: none;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .option-group {
            display: flex;
            flex-direction: column;
        }

        .option-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.9em;
        }

        .option-input {
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .option-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .convert-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .convert-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .convert-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #667eea;
            font-weight: 600;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .result-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-icon {
            font-size: 1.5em;
            color: #667eea;
        }

        .download-btn {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin: 10px 0;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">PDF ⟷ PNG Converter</h1>
            <p class="subtitle">Convert between PDF and PNG formats with ease</p>
        </div>

        <div class="converter-tabs">
            <button class="tab-button active" onclick="switchTab('pdf-to-png')">PDF to PNG</button>
            <button class="tab-button" onclick="switchTab('png-to-pdf')">PNG to PDF</button>
        </div>

        <!-- PDF to PNG Section -->
        <div id="pdf-to-png" class="converter-section active">
            <div class="drop-zone" onclick="document.getElementById('pdf-input').click()" ondrop="handleDrop(event, 'pdf')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="drop-icon">📄</div>
                <div class="drop-text">Drop PDF file here or click to browse</div>
                <div class="drop-subtext">Supports PDF files up to 50MB</div>
            </div>
            <input type="file" id="pdf-input" class="file-input" accept=".pdf" onchange="handleFileSelect(event, 'pdf')">
            
            <div class="options">
                <div class="option-group">
                    <label class="option-label">Output Quality</label>
                    <select class="option-input" id="pdf-quality">
                        <option value="1">Low (72 DPI)</option>
                        <option value="2" selected>Medium (144 DPI)</option>
                        <option value="3">High (216 DPI)</option>
                        <option value="4">Ultra (288 DPI)</option>
                    </select>
                </div>
                <div class="option-group">
                    <label class="option-label">Page Range</label>
                    <input type="text" class="option-input" id="pdf-pages" placeholder="e.g., 1-5 or 1,3,5 (leave empty for all)">
                </div>
            </div>
            
            <button class="convert-btn" id="pdf-convert-btn" onclick="convertPdfToPng()" disabled>
                Convert PDF to PNG
            </button>
        </div>

        <!-- PNG to PDF Section -->
        <div id="png-to-pdf" class="converter-section">
            <div class="drop-zone" onclick="document.getElementById('png-input').click()" ondrop="handleDrop(event, 'png')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="drop-icon">🖼️</div>
                <div class="drop-text">Drop PNG files here or click to browse</div>
                <div class="drop-subtext">Supports multiple PNG files</div>
            </div>
            <input type="file" id="png-input" class="file-input" accept=".png" multiple onchange="handleFileSelect(event, 'png')">
            
            <div class="options">
                <div class="option-group">
                    <label class="option-label">Page Size</label>
                    <select class="option-input" id="png-page-size">
                        <option value="A4">A4 (210 × 297 mm)</option>
                        <option value="Letter">Letter (8.5 × 11 in)</option>
                        <option value="Legal">Legal (8.5 × 14 in)</option>
                        <option value="Fit">Fit to Image</option>
                    </select>
                </div>
                <div class="option-group">
                    <label class="option-label">Image Fit</label>
                    <select class="option-input" id="png-fit">
                        <option value="contain">Fit (preserve aspect ratio)</option>
                        <option value="cover">Fill (may crop)</option>
                        <option value="stretch">Stretch to fit</option>
                    </select>
                </div>
            </div>
            
            <button class="convert-btn" id="png-convert-btn" onclick="convertPngToPdf()" disabled>
                Convert PNG to PDF
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <span>Converting...</span>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let selectedFiles = [];
        let currentMode = 'pdf-to-png';

        function switchTab(mode) {
            // Update active tab
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update active section
            document.querySelectorAll('.converter-section').forEach(section => section.classList.remove('active'));
            document.getElementById(mode).classList.add('active');

            currentMode = mode;
            selectedFiles = [];
            updateConvertButton();
            hideResults();
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e, type) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            processFiles(files, type);
        }

        function handleFileSelect(e, type) {
            const files = Array.from(e.target.files);
            processFiles(files, type);
        }

        function processFiles(files, type) {
            const validFiles = files.filter(file => {
                if (type === 'pdf') {
                    return file.type === 'application/pdf';
                } else {
                    return file.type === 'image/png';
                }
            });

            if (validFiles.length === 0) {
                showError(`Please select valid ${type.toUpperCase()} files.`);
                return;
            }

            selectedFiles = validFiles;
            updateConvertButton();
            hideResults();
            showFilePreview(validFiles, type);
        }

        function showFilePreview(files, type) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h3 style="margin-bottom: 15px; color: #333;">Selected Files:</h3>
                ${files.map((file, index) => `
                    <div class="result-item">
                        <div class="result-info">
                            <span class="result-icon">${type === 'pdf' ? '📄' : '🖼️'}</span>
                            <div>
                                <div style="font-weight: 600;">${file.name}</div>
                                <div style="color: #666; font-size: 0.9em;">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
            resultsDiv.style.display = 'block';
        }

        function updateConvertButton() {
            const pdfBtn = document.getElementById('pdf-convert-btn');
            const pngBtn = document.getElementById('png-convert-btn');
            
            if (currentMode === 'pdf-to-png') {
                pdfBtn.disabled = selectedFiles.length === 0;
            } else {
                pngBtn.disabled = selectedFiles.length === 0;
            }
        }

        async function convertPdfToPng() {
            if (selectedFiles.length === 0) return;

            showLoading();
            hideResults();

            try {
                const file = selectedFiles[0];
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                const quality = parseInt(document.getElementById('pdf-quality').value);
                const scale = quality; // Scale factor for rendering
                const pagesInput = document.getElementById('pdf-pages').value.trim();
                
                let pagesToConvert = [];
                if (pagesInput) {
                    pagesToConvert = parsePageRange(pagesInput, pdf.numPages);
                } else {
                    pagesToConvert = Array.from({ length: pdf.numPages }, (_, i) => i + 1);
                }

                const results = [];
                
                for (const pageNum of pagesToConvert) {
                    try {
                        const page = await pdf.getPage(pageNum);
                        const viewport = page.getViewport({ scale });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        await page.render({ canvasContext: context, viewport }).promise;
                        
                        const blob = await new Promise(resolve => {
                            canvas.toBlob(resolve, 'image/png', 1.0);
                        });

                        const filename = `${file.name.replace('.pdf', '')}_page_${pageNum}.png`;
                        results.push({ blob, filename, pageNum });
                    } catch (error) {
                        console.error(`Error converting page ${pageNum}:`, error);
                    }
                }

                hideLoading();
                showResults(results, 'png');
                
            } catch (error) {
                hideLoading();
                showError('Error converting PDF: ' + error.message);
            }
        }

        async function convertPngToPdf() {
            if (selectedFiles.length === 0) return;

            showLoading();
            hideResults();

            try {
                const pdfDoc = await PDFLib.PDFDocument.create();
                const pageSize = document.getElementById('png-page-size').value;
                const fitMode = document.getElementById('png-fit').value;

                for (const file of selectedFiles) {
                    const arrayBuffer = await file.arrayBuffer();
                    const pngImage = await pdfDoc.embedPng(arrayBuffer);
                    
                    let page;
                    if (pageSize === 'Fit') {
                        page = pdfDoc.addPage([pngImage.width, pngImage.height]);
                        page.drawImage(pngImage, {
                            x: 0,
                            y: 0,
                            width: pngImage.width,
                            height: pngImage.height,
                        });
                    } else {
                        // Standard page sizes
                        const pageSizes = {
                            'A4': [595, 842],
                            'Letter': [612, 792],
                            'Legal': [612, 1008]
                        };
                        
                        const [pageWidth, pageHeight] = pageSizes[pageSize];
                        page = pdfDoc.addPage([pageWidth, pageHeight]);
                        
                        const { width, height, x, y } = calculateImageDimensions(
                            pngImage.width, pngImage.height, 
                            pageWidth, pageHeight, fitMode
                        );
                        
                        page.drawImage(pngImage, { x, y, width, height });
                    }
                }

                const pdfBytes = await pdfDoc.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                
                const filename = selectedFiles.length === 1 
                    ? selectedFiles[0].name.replace('.png', '.pdf')
                    : 'converted_images.pdf';

                hideLoading();
                showResults([{ blob, filename }], 'pdf');
                
            } catch (error) {
                hideLoading();
                showError('Error converting PNG to PDF: ' + error.message);
            }
        }

        function calculateImageDimensions(imgWidth, imgHeight, pageWidth, pageHeight, fitMode) {
            const imgAspectRatio = imgWidth / imgHeight;
            const pageAspectRatio = pageWidth / pageHeight;
            
            let width, height, x, y;
            
            if (fitMode === 'contain') {
                if (imgAspectRatio > pageAspectRatio) {
                    width = pageWidth;
                    height = pageWidth / imgAspectRatio;
                } else {
                    width = pageHeight * imgAspectRatio;
                    height = pageHeight;
                }
                x = (pageWidth - width) / 2;
                y = (pageHeight - height) / 2;
            } else if (fitMode === 'cover') {
                if (imgAspectRatio > pageAspectRatio) {
                    width = pageHeight * imgAspectRatio;
                    height = pageHeight;
                } else {
                    width = pageWidth;
                    height = pageWidth / imgAspectRatio;
                }
                x = (pageWidth - width) / 2;
                y = (pageHeight - height) / 2;
            } else { // stretch
                width = pageWidth;
                height = pageHeight;
                x = 0;
                y = 0;
            }
            
            return { width, height, x, y };
        }

        function parsePageRange(input, totalPages) {
            const pages = [];
            const parts = input.split(',');
            
            for (const part of parts) {
                const trimmed = part.trim();
                if (trimmed.includes('-')) {
                    const [start, end] = trimmed.split('-').map(n => parseInt(n.trim()));
                    for (let i = start; i <= Math.min(end, totalPages); i++) {
                        if (i >= 1) pages.push(i);
                    }
                } else {
                    const pageNum = parseInt(trimmed);
                    if (pageNum >= 1 && pageNum <= totalPages) {
                        pages.push(pageNum);
                    }
                }
            }
            
            return [...new Set(pages)].sort((a, b) => a - b);
        }

        function showResults(results, type) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h3 style="margin-bottom: 15px; color: #333;">Conversion Complete!</h3>
                ${results.map((result, index) => `
                    <div class="result-item">
                        <div class="result-info">
                            <span class="result-icon">${type === 'pdf' ? '📄' : '🖼️'}</span>
                            <div>
                                <div style="font-weight: 600;">${result.filename}</div>
                                <div style="color: #666; font-size: 0.9em;">${formatFileSize(result.blob.size)}</div>
                            </div>
                        </div>
                        <button class="download-btn" onclick="downloadFile('${result.filename}', ${index})">
                            Download
                        </button>
                    </div>
                `).join('')}
            `;
            resultsDiv.style.display = 'block';
            
            // Store results for download
            window.conversionResults = results;
        }

        function downloadFile(filename, index) {
            const result = window.conversionResults[index];
            const url = URL.createObjectURL(result.blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function hideResults() {
            document.getElementById('results').style.display = 'none';
        }

        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<div class="error">${message}</div>`;
            resultsDiv.style.display = 'block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>